<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PG Digital Butler</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #001a33 0%, #003366 100%);
            min-height: 100vh;
            transition: background 0.5s ease, color 0.5s ease;
        }
        body.sanctuary-mode {
            background: linear-gradient(135deg, #000011 0%, #001122 100%);
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        .gold-accent {
            color: #c5a059;
            transition: color 0.3s ease;
        }
        .gold-bg {
            background-color: #c5a059;
            transition: background-color 0.3s ease;
        }
        .gold-border {
            border-color: #c5a059;
            transition: border-color 0.3s ease;
        }
        .welcome-font {
            font-family: 'Playfair Display', serif;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 26, 51, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal.show {
            opacity: 1;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 2rem;
            max-width: 90%;
            width: 400px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal.show .modal-content {
            transform: scale(1);
        }
        /* Quick Actions */
        .quick-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            cursor: pointer;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }
        .quick-action:hover {
            transform: translateY(-5px);
            opacity: 0.8;
        }
        .quick-action svg {
            width: 40px;
            height: 40px;
            margin-bottom: 0.5rem;
            fill: #c5a059;
            transition: fill 0.3s ease;
        }
        /* Live Map Tracker */
        #liveMap {
            position: relative;
            height: 200px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            display: none;
        }
        #mapBackground {
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23003366"/><circle cx="50" cy="50" r="2" fill="%23c5a059"/></svg>') repeat;
            opacity: 0.5;
        }
        #tahoeIcon {
            position: absolute;
            top: 50%;
            left: -50px;
            width: 40px;
            height: 20px;
            background: #c5a059;
            border-radius: 4px;
            animation: driveIn 5s linear infinite;
        }
        @keyframes driveIn {
            0% { left: -50px; }
            100% { left: calc(100% + 50px); }
        }
        /* Sanctuary Mode Toggle */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .toggle-switch.active {
            background: #c5a059;
        }
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }
        /* SOS Button Styles */
        #sosButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            background-color: #ff0000;
            border-radius: 50%;
            border: 4px solid #ffffff;
            box-shadow: 0 4px 12px rgba(255, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        #sosButton:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(255, 0, 0, 0.7);
        }
        #sosButton:active {
            transform: scale(0.95);
        }
        #sosButton svg {
            width: 40px;
            height: 40px;
            fill: white;
        }
        #sosButton.pulse {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 4px 12px rgba(255, 0, 0, 0.5); }
            50% { box-shadow: 0 4px 20px rgba(255, 0, 0, 1); }
            100% { box-shadow: 0 4px 12px rgba(255, 0, 0, 0.5); }
        }
        /* Confirmation Modal */
        #confirmationModal .modal-content {
            text-align: center;
        }
        #confirmationModal svg {
            width: 60px;
            height: 60px;
            fill: #c5a059;
            margin: 0 auto 1rem;
            animation: checkmark 0.5s ease;
        }
        @keyframes checkmark {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="text-white">
    <!-- Header with Welcome, Weather, and Sanctuary Mode Toggle -->
    <header class="p-6 glassmorphism m-4">
        <div class="flex justify-between items-center">
            <h1 id="welcomeMessage" class="text-2xl welcome-font gold-accent">Welcome, Guest - Villa 00</h1>
            <div class="flex items-center space-x-4">
                <div id="weatherWidget" class="text-right">
                    <p class="text-sm">Río San Juan, RD</p>
                    <p id="weatherInfo" class="text-lg">Loading...</p>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-sm">Sanctuary Mode</span>
                    <div id="sanctuaryToggle" class="toggle-switch" onclick="toggleSanctuaryMode()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Quick Actions Section -->
    <section class="p-4 glassmorphism m-4">
        <h2 class="text-xl welcome-font gold-accent mb-4">Quick Actions</h2>
        <div class="grid grid-cols-4 gap-4" id="quickActions">
            <!-- Actions will be populated based on profile -->
        </div>
    </section>

    <!-- Live Map Tracker (Hidden initially, shown after transportation request) -->
    <section class="p-4 glassmorphism m-4" id="liveMapSection">
        <h2 class="text-xl welcome-font gold-accent mb-4">Live Map Tracker</h2>
        <p class="mb-2">Your Tahoe is being prepared</p>
        <div id="liveMap">
            <div id="mapBackground"></div>
            <div id="tahoeIcon"></div>
        </div>
    </section>

    <!-- Service Sections -->
    <main class="p-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <section class="glassmorphism p-6 text-center cursor-pointer hover:scale-105 transition-transform" onclick="openForm('restaurants')">
            <h2 class="text-xl font-semibold gold-accent mb-2">RESTAURANTS</h2>
            <p class="text-sm">Book your dining experience</p>
        </section>
        <section class="glassmorphism p-6 text-center cursor-pointer hover:scale-105 transition-transform" onclick="openForm('transportation')">
            <h2 class="text-xl font-semibold gold-accent mb-2">TRANSPORTATION</h2>
            <p class="text-sm">Request Tahoe service</p>
        </section>
        <section class="glassmorphism p-6 text-center cursor-pointer hover:scale-105 transition-transform" onclick="openForm('spa')">
            <h2 class="text-xl font-semibold gold-accent mb-2">SPA & WELLNESS</h2>
            <p class="text-sm">Relax and rejuvenate</p>
        </section>
        <section class="glassmorphism p-6 text-center cursor-pointer hover:scale-105 transition-transform" onclick="openForm('golf')">
            <h2 class="text-xl font-semibold gold-accent mb-2">GOLF & CADDIES</h2>
            <p class="text-sm">Tee off with style</p>
        </section>
        <section class="glassmorphism p-6 text-center cursor-pointer hover:scale-105 transition-transform" onclick="openForm('activities')">
            <h2 class="text-xl font-semibold gold-accent mb-2">ACTIVITIES</h2>
            <p class="text-sm">Explore operations</p>
        </section>
    </main>

    <!-- Modal for Forms -->
    <div id="serviceModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle" class="text-2xl welcome-font gold-accent mb-4">Book Service</h3>
            <form id="serviceForm">
                <input type="hidden" id="hiddenName" name="name">
                <input type="hidden" id="hiddenVilla" name="villa">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Date</label>
                    <input type="date" id="serviceDate" required class="w-full p-3 bg-white bg-opacity-20 border gold-border rounded-md text-white focus:ring-2 focus:ring-yellow-500">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Time</label>
                    <input type="time" id="serviceTime" required class="w-full p-3 bg-white bg-opacity-20 border gold-border rounded-md text-white focus:ring-2 focus:ring-yellow-500">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Special Requirements</label>
                    <textarea id="specialReq" rows="3" class="w-full p-3 bg-white bg-opacity-20 border gold-border rounded-md text-white focus:ring-2 focus:ring-yellow-500 placeholder-white" placeholder="Any special requests..."></textarea>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-500 rounded-md hover:bg-gray-600 transition-all">Cancel</button>
                    <button type="submit" class="px-4 py-2 gold-bg text-black rounded-md hover:bg-opacity-80 transition-all">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <svg viewBox="0 0 24 24">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
            <h3 class="text-xl welcome-font gold-accent mb-2">Request Received</h3>
            <p class="text-sm">Our team is personalizing your experience. You will be notified shortly.</p>
            <button onclick="closeConfirmation()" class="mt-4 px-4 py-2 gold-bg text-black rounded-md hover:bg-opacity-80 transition-all">OK</button>
        </div>
    </div>

    <!-- SOS Button (Floating) -->
    <button id="sosButton" title="Emergency SOS">
        <svg viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-.61 0-1.11-.5-1.11-1.11 0-.61.5 1.11 1.11-1.11.61 0 1.11.5 1.11 1.11 0 .61-.5 1.11-1.11 1.11zm1.05-16.32c-.61 0-1.11.5-1.11 1.11v8.26c0 .61.5 1.11 1.11 1.11.61 0 1.11-.5 1.11-1.11V4.72c0-.61-.5-1.11-1.11-1.11z"/>
        </svg>
    </button>

    <!-- SOS Confirmation Modal -->
    <div id="sosConfirmModal" class="modal">
        <div class="modal-content">
            <h3>EMERGENCY ALERT</h3>
            <p>Press and hold for 2 seconds to confirm SOS.</p>
            <button onclick="cancelSOS()" class="mt-4 px-4 py-2 bg-gray-500 rounded-md hover:bg-gray-600 transition-all">Cancel</button>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            GOOGLE_APPS_SCRIPT_URL: "YOUR_GOOGLE_APPS_SCRIPT_URL",  // Replace with your deployed script URL
            OPENWEATHER_API_KEY: "YOUR_OPENWEATHER_API_KEY",       // Replace with your OpenWeather API key
            LOCATION: "Río San Juan,DO"  // Location for weather
        };

        // Global variables
        let currentService = '';
        let guestName = 'Guest';
        let villaNumber = '00';
        let sosPressTimer = null;  // Timer for SOS press and hold
        let sanctuaryMode = false; // Sanctuary mode state

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(registration => {
                console.log('Service Worker registered');
            }).catch(error => {
                console.log('Service Worker registration failed');
            });
        }

        // Parse URL parameters
        function parseURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            guestName = urlParams.get('name') || 'Guest';
            villaNumber = urlParams.get('villa') || '00';
            document.getElementById('welcomeMessage').textContent = `Welcome, ${guestName} - Villa ${villaNumber}`;
            document.getElementById('hiddenName').value = guestName;
            document.getElementById('hiddenVilla').value = villaNumber;
            populateQuickActions();
        }

        // Populate Quick Actions based on profile
        function populateQuickActions() {
            const actions = [
                { icon: '<svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>', label: 'Favorite Restaurant', action: () => openForm('restaurants') },
                { icon: '<svg viewBox="0 0 24 24"><path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 